<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Dashboard COPSOQ</title>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 30px;
    }

    h1 {
      margin-bottom: 30px;
    }

    /* =========================
       STATUS GERAL
       ========================= */
    .status-geral {
      padding: 25px;
      border-radius: 14px;
      font-size: 26px;
      font-weight: bold;
      color: white;
      text-align: center;
      margin-bottom: 40px;
    }

    .status-alto { background: #e74c3c; }
    .status-moderado { background: #f1c40f; color: #333; }
    .status-baixo { background: #2ecc71; }

    /* =========================
       CARDS
       ========================= */
    s {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margi.cardn-bottom: 40px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
      text-align: center;
    }

    .card h3 {
      margin-bottom: 10px;
      color: #555;
      font-size: 16px;
    }

    .card strong {
      font-size: 32px;
    }

    /* =========================
       LAYOUT EM LINHA
       ========================= */
    .linha {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .bloco {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
    }

    .lista div {
      padding: 14px;
      margin-bottom: 12px;
      border-left: 8px solid;
      border-radius: 6px;
      background: #fafafa;
    }

    .baixo { border-color: #2ecc71; }
    .moderado { border-color: #f1c40f; }
    .alto { border-color: #e74c3c; }

/* =========================
   LEGENDA DE CORES
   ========================= */
.legenda {
  background: white;
  padding: 22px 26px;
  border-radius: 14px;
  box-shadow: 0 2px 6px rgba(0,0,0,.1);
  display: flex;
  flex-direction: column;
  gap: 16px;
}

.legenda-item {
  display: flex;
  align-items: center;
  gap: 14px;
  font-size: 17px;
  font-weight: 600;
  white-space: nowrap;
}

.legenda-cor {
  width: 18px;
  height: 18px;
  border-radius: 4px;
  flex-shrink: 0;
}

.cor-alto { background: #e74c3c; }
.cor-moderado { background: #f1c40f; }
.cor-baixo { background: #2ecc71; }
body {
      font-family: Arial, sans-serif;
      background: #f4f6f8;
      padding: 30px;
    }

    h1 {
      margin-bottom: 30px;
    }

    /* =========================
       STATUS GERAL
       ========================= */
    .status-geral {
      padding: 25px;
      border-radius: 14px;
      font-size: 26px;
      font-weight: bold;
      color: white;
      text-align: center;
      margin-bottom: 40px;
    }

    .status-alto { background: #e74c3c; }
    .status-moderado { background: #f1c40f; color: #333; }
    .status-baixo { background: #2ecc71; }

/* ===== RESUMO GERAL ===== */
.resumo-ranking {
  background: white;
  padding: 30px;
  border-radius: 14px;
  box-shadow: 0 2px 8px rgba(0,0,0,.08);
  margin-top: 40px;
}

.resumo-ranking h2 {
  margin-bottom: 25px;
}

.resumo-grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 30px;
}

.risco-item {
  display: flex;
  align-items: center;
  font-size: 18px;
  margin-bottom: 18px;
}

.risco-cor {
  width: 22px;
  height: 22px;
  border-radius: 6px;
  margin-right: 14px;
}

.vermelho { background: #e74c3c; }
.laranja  { background: #e67e22; }
.amarelo  { background: #f1c40f; }
.verde    { background: #2ecc71; }


    /* =========================
       CARDS RESUMO
       ========================= */
    .cards {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin-bottom: 40px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
      text-align: center;
    }

    .card h3 {
      margin-bottom: 10px;
      color: #555;
      font-size: 16px;
    }

    .card strong {
      font-size: 32px;
    }

    /* =========================
       LAYOUT
       ========================= */
    .linha {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 30px;
      margin-bottom: 40px;
    }

    .bloco {
      background: white;
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 2px 6px rgba(0,0,0,.1);
      margin-bottom: 30px;
    }

    .lista div {
      padding: 14px;
      margin-bottom: 12px;
      border-left: 8px solid;
      border-radius: 6px;
      background: #fafafa;
    }

    .baixo { border-color: #2ecc71; }
    .moderado { border-color: #f1c40f; }
    .alto { border-color: #e74c3c; }

    /* =========================
       PRIORIDADES (CORRETO)
       ========================= */
    .prioridade-linha {
      display: flex;
      gap: 16px;
      padding: 14px 18px;
      border-radius: 10px;
      margin-bottom: 14px;
      background: #fff;
      border: 1px solid #eee;
    }

    .icone {
      min-width: 56px;
      height: 36px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 18px;
    }

    .texto strong {
      display: block;
      font-size: 16px;
      margin-bottom: 6px;
    }

    .texto ul {
      margin: 0;
      padding-left: 18px;
    }

    .texto li {
      font-size: 14px;
      margin-bottom: 4px;
    }

    .risco-vermelho .icone { background: #e74c3c; color: #fff; }
    .risco-laranja  .icone { background: #e67e22; color: #fff; }
    .risco-amarelo  .icone { background: #f1c40f; color: #333; }
    .risco-verde    .icone { background: #2ecc71; color: #fff; }

    /* =========================
   DIAGN√ìSTICO EM DUAS COLUNAS
   ========================= */
.lista {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 16px 20px;
}

/* Garante que cada item n√£o quebre no PDF */
.item-diagnostico {
  break-inside: avoid;
  page-break-inside: avoid;
}

/* No print continua em duas colunas */
@media print {
  .lista {
    grid-template-columns: 1fr 1fr;
  }
}

/* =========================
   AJUSTE DE ALTURA DOS CARDS
   ========================= */

/* Cards principais */
.resumo-ranking,
.card {
  padding: 20px !important;
}

/* Grid do resumo */
.resumo-grid {
  align-items: start;
}

/* Itens de risco mais compactos */
.risco-item {
  margin-bottom: 10px;
  font-size: 16px;
}

/* Remove sobra vertical */
.resumo-ranking h2 {
  margin-bottom: 15px;
}
/* =========================
   PRIORIDADES MAIS COMPACTAS
   ========================= */

.priority {
  padding: 14px 16px;
  margin-bottom: 10px;
}

.priority ul {
  margin-top: 6px;
  margin-bottom: 0;
}

.priority li {
  margin: 2px 0;
  font-size: 14px;
}

.priority .header {
  font-size: 16px;
}
.linha,
.resumo-grid {
  align-items: flex-start;
}


    /* =========================
       PRINT
       ========================= */
    @media print {
      * {
        -webkit-print-color-adjust: exact !important;
        print-color-adjust: exact !important;
      }

      body {
        background: white;
        padding: 0;
      }

      button {
        display: none;
      }

      .card,
      .bloco,
      .status-geral {
        box-shadow: none;
      }
    }
.grid-dashboard {
  display: grid;
  grid-template-columns: 1.3fr 1fr;
  gap: 30px;
  align-items: start;
}
/* =========================
   AJUSTE A4 ‚Äì FOR√áAR 1 P√ÅGINA
   ========================= */
@media print {

  @page {
    size: A4 portrait;
    margin: 12mm;
  }

  body {
    zoom: 0.85; /* CHAVE para caber tudo */
  }

  /* Evita que blocos quebrem */
  .status-geral,
  .bloco,
  .resumo-ranking,
  .prioridade-linha,
  .legenda {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Diagn√≥stico nunca quebra item */
  .item-diagnostico {
    break-inside: avoid;
    page-break-inside: avoid;
  }

  /* Grid principal n√£o quebra */
  .grid-dashboard {
    break-inside: avoid;
  }

  /* Gr√°fico mais compacto */
  canvas {
    max-height: 280px !important;
  }

  /* Reduz espa√ßamentos verticais */
  h1 {
    margin-bottom: 12px;
  }

  h2 {
    margin-bottom: 10px;
  }

  .bloco {
    padding: 16px;
    margin-bottom: 16px;
  }

  .resumo-ranking {
    padding: 16px;
    margin-top: 16px;
  }

  .prioridade-linha {
    padding: 10px 12px;
    margin-bottom: 8px;
  }

  .lista div {
    padding: 10px;
    margin-bottom: 8px;
  }

  /* Remove sombras no PDF */
  * {
    box-shadow: none !important;
  }

  /* Bot√£o n√£o aparece */
  button {
    display: none !important;
  }
}
/* Na tela */
.grafico-container.pdf {
  display: none;
}
  </style>
</head>

<body>

<h1>Dashboard de Riscos Psicossociais ‚Äì COPSOQ</h1>

{% if tabela|length == 0 %}
  <div class="status-geral status-moderado">
    ‚ö†Ô∏è Ainda n√£o h√° respostas suficientes para gerar o diagn√≥stico
  </div>
{% else %}

  {% set media_geral = (tabela | map(attribute='media') | sum / tabela|length) %}

  {% if media_geral > 3.5 %}
    <div class="status-geral status-alto">
      üü• Empresa em <strong>ALTO RISCO</strong> psicossocial
    </div>
  {% elif media_geral > 2 %}
    <div class="status-geral status-moderado">
      üü® Empresa em <strong>RISCO MODERADO</strong> psicossocial
    </div>
  {% else %}
    <div class="status-geral status-baixo">
      üü© Empresa em <strong>BAIXO RISCO</strong> psicossocial
    </div>
  {% endif %}

{% endif %}

<!-- =========================
     CARDS RESUMO
     ========================= -->
<div class="cards">
  <div class="card">
    <h3>Subescalas avaliadas</h3>
    <strong>{{ tabela|length }}</strong>
  </div>

  <div class="card">
    <h3>M√©dia geral</h3>
    <strong>
      {% if tabela|length > 0 %}
        {{ media_geral | round(2) }}
      {% else %}
        ‚Äî
      {% endif %}
    </strong>
  </div>

<div class="legenda">
  <div class="legenda-item">
    <div class="legenda-cor cor-alto"></div>
    Empresa em <strong>ALTO RISCO</strong> psicossocial
  </div>

  <div class="legenda-item">
    <div class="legenda-cor cor-moderado"></div>
    Empresa em <strong>RISCO MODERADO</strong> psicossocial
  </div>

  <div class="legenda-item">
    <div class="legenda-cor cor-baixo"></div>
   Empresa em <strong>BAIXO RISCO</strong> psicossocial
  </div>
</div>
</div>

  <!-- COLUNA ESQUERDA -->
  <div class="coluna-esquerda">

    <div class="bloco">
      <h2>M√©dia por Subescala</h2>
      <canvas id="grafico"></canvas>
    </div>
  </div>


  <!-- COLUNA DIREITA -->
  <div class="bloco diagnostico-print">
    <h2>Diagn√≥stico por Subescala</h2>

    <div class="lista">
      {% for item in tabela %}
        <div class="item-diagnostico
          {% if item.risco == 'Baixo risco' %}baixo
          {% elif item.risco == 'Risco moderado' %}moderado
          {% else %}alto{% endif %}
        ">
          <strong>{{ item.subescala }}</strong><br>
          M√©dia: {{ item.media }} ‚Äî {{ item.risco }}
        </div>
      {% endfor %}
    </div>
    
  </div>
  
<div class="resumo-ranking">
  <h2>Resumo Geral ‚Äì Ranking das Subescalas</h2>

  <div class="resumo-grid">

    <div>
      <div class="risco-item">
        <div class="risco-cor vermelho"></div>
        <strong>Risco Muito Alto</strong> (4.1 ‚Äì 5.0)
      </div>

      <div class="risco-item">
        <div class="risco-cor laranja"></div>
        <strong>Risco Alto</strong> (3.1 ‚Äì 4.0)
      </div>

      <div class="risco-item">
        <div class="risco-cor amarelo"></div>
        <strong>Risco Moderado</strong> (2.1 ‚Äì 3.0)
      </div>

      <div class="risco-item">
        <div class="risco-cor verde"></div>
        <strong>Risco Baixo</strong> (0 ‚Äì 2.0)
      </div>
    </div>

   <div>
  <div class="risco-item">
    <div class="risco-cor vermelho"></div>
    {{ tabela | selectattr("media", ">=", 4.1) | list | length }}
    Risco Muito Alto (4.1 ‚Äì 5.0)
  </div>

  <div class="risco-item">
    <div class="risco-cor laranja"></div>
    {{ tabela
       | selectattr("media", ">=", 3.1)
       | selectattr("media", "<=", 4.0)
       | list | length }}
    Risco Alto (3.1 ‚Äì 4.0)
  </div>

  <div class="risco-item">
    <div class="risco-cor amarelo"></div>
    {{ tabela
       | selectattr("media", ">=", 2.1)
       | selectattr("media", "<=", 3.0)
       | list | length }}
    Risco Moderado (2.1 ‚Äì 3.0)
  </div>

  <div class="risco-item">
    <div class="risco-cor verde"></div>
    {{ tabela | selectattr("media", "<=", 2.0) | list | length }}
    Risco Baixo (0 ‚Äì 2.0)
  </div>
</div>


  </div>
</div>
<br>
<div class="bloco">
  <h2>Prioridades de Interven√ß√£o</h2>

  <div class="prioridade-linha risco-vermelho">
    <div class="icone">üî•üî•</div>
    <div class="texto">
      <strong>Interven√ß√£o imediata </strong>
    <ul>
    {% for i in tabela if i.media > 4 %}
    <li>{{ i.subescala }}</li>
    {% endfor %}
    </ul>
    </div>
  </div>

  <div class="prioridade-linha risco-laranja">
    <div class="icone">‚ö†Ô∏è</div>
    <div class="texto">
      <strong>Plano de a√ß√£o </strong>
    <ul>
    {% for i in tabela if i.media > 3 and i.media <= 4 %}
  <li>{{ i.subescala }}</li>
    {% endfor %}
    </ul>

    </div>
  </div>

  <div class="prioridade-linha risco-amarelo">
    <div class="icone">üëÄ</div>
    <div class="texto">
      <strong>Monitorar </strong>
      <ul>
    {% for i in tabela if i.media > 2 and i.media <= 3 %}
    <li>{{ i.subescala }}</li>
    {% endfor %}
    </ul>
    </div>
  </div>

  <div class="prioridade-linha risco-verde">
    <div class="icone">‚úÖ</div>
    <div class="texto">
      <strong>Manter </strong>
      <ul>
{% for i in tabela if i.media <= 2 %}
  <li>{{ i.subescala }}</li>
{% endfor %}
</ul>

    </div>
  </div>
</div>


</div>




</div>


<script>
const dados = {{ tabela | tojson }};

const labels = dados.map(d => d.subescala);
const medias = dados.map(d => d.media);
const cores = dados.map(d => {
  if (d.risco === "Baixo risco") return "#2ecc71";
  if (d.risco === "Risco moderado") return "#f1c40f";
  return "#e74c3c";
});

new Chart(document.getElementById("grafico"), {
  type: "bar",
  data: {
    labels: labels,
    datasets: [{
      data: medias,
      backgroundColor: cores
    }]
  },
  options: {
    indexAxis: 'y',
    plugins: { legend: { display: false } },
    scales: {
      x: { min: 0, max: 5 }
    }
  }
});

</script>


<button onclick="window.print()">üìÑ Exportar PDF</button>





</body>
</html>
